<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">

    <title>Nutrition List</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  </head>
  <body>

    <div id="nutritioncontainer" class="container">
        <h1 class="display-4">Nutrition List Search</h1>
        <form id="foodform">
            Search food item: <input type="text" id="food">
            <button type="button" onclick="search()">Submit</button>
        </form>
        <br><br>
        <div id="results"></div>
    </div>





    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js" integrity="sha384-SR1sx49pcuLnqZUnnPwx6FCym0wLsk5JZuNx2bPPENzswTNFaQU1RDvt3wT4gWFG" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.min.js" integrity="sha384-j0CNLUeiqtyaRmlzUHCPZ+Gy5fQu0dQ6eZ/xAww941Ai1SxSY+0EQqNXNE6DZiVc" crossorigin="anonymous"></script>
    -->

    <script>
        function searchapi(query) {
            var url = "https://api.calorieninjas.com/v1/nutrition?query=" + query;
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {

                    var data = JSON.parse(this.responseText);
                    console.log(data);
                    var items = data.items;
                    console.log(items);
                    var html_text = '';
                    
                    if (items.length){

                        for (item of items) {
                            var sugar_g = item.sugar_g;
                            var fiber_g = item.fiber_g;
                            var serving_size_g = item.serving_size_g;
                            var sodium_mg = item.sodium_mg;
                            var name = item.name;
                            var potassium_mg = item.potassium_mg;
                            var fat_saturated_g = item.fat_saturated_g;
                            var fat_total_g = item.fat_total_g;
                            var calories = item.calories;
                            var cholesterol_mg = item.cholesterol_mg;
                            var protein_g = item.protein_g;
                            var carbohydrates_total_g = item.carbohydrates_total_g;

                            var node = document.createElement('div');
                            node.innerHTML = `
                            <div class="${name}">
                                <h1 style='text-transform:capitalize;'><strong>${name}</strong></h1>
                                <table id="nutritionTable${name}" class="table table-striped" border='1'>
                                    <thead class="thead-dark">
                                        <tr>
                                            <th>Serving Size (g)</th>
                                            <td>${serving_size_g}</td>
                                        </tr>
                                        <tr>
                                            <th>Sugar (g)</th>
                                            <td>${sugar_g}</td>
                                        </tr>
                                        <tr>
                                            <th>Fiber (g)</th>
                                            <td>${fiber_g}</td>
                                        </tr>
                                        <tr>
                                            <th>Sodium (mg)</th>
                                            <td>${sodium_mg}</td>
                                        </tr>
                                        <tr>
                                            <th>Potassium (mg)</th>
                                            <td>${potassium_mg}</td>
                                        </tr>
                                        <tr>
                                            <th>Saturated Fats (g)</th>
                                            <td>${fat_saturated_g}</td>
                                        </tr>
                                        <tr>
                                            <th>Total Fats (g)</th>
                                            <td>${fat_total_g}</td>
                                        </tr>
                                        <tr>
                                            <th>Calories</th>
                                            <td>${calories}</td>
                                        </tr>
                                        <tr>
                                            <th>Cholesterol (mg)</th>
                                            <td>${cholesterol_mg}</td>
                                        </tr>
                                        <tr>
                                            <th>Protein (g)</th>
                                            <td>${protein_g}</td>
                                        </tr>
                                        <tr>
                                            <th>Total Carbohydrates (g)</th>
                                            <td>${carbohydrates_total_g}</td>
                                        </tr>

                                    </thead>
                                </table>
                            </div>
                            `;
                        }

                    } else {
                        var node = document.createElement('div');
                        node.innerHTML = `<h2 style='color:red'>Error: Item <strong>${query}</strong> not found</h2>`;
                    }

                        // document.getElementById("results").appendChild(node);
                        document.getElementById("results").innerHTML += node.innerHTML;
                    
                }
            };

            xhttp.open('GET', url, true);
            xhttp.setRequestHeader('X-Api-Key', 'REtXb+Q4bQ2JMKCYXL7+3g==urfa511CyFMRg6g0');
            xhttp.send();

        }
        function search() {
            document.getElementById('results').innerHTML = '';
            var query = document.getElementById('food').value;
            var result = searchapi(query);
            
        }
        


    </script>
  </body>
</html>