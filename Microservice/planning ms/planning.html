<!DOCTYPE html>
<html>
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Meal Planner</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">

    <!-- <script src="js/main.js"></script> -->
</head>
<body>
    <!-- <div id="isUser" style="display:none;"><?=$username?></div> -->
    <div class="container-fluid" id='schedule'>
        <div class="row d-flex">

            <div class="col-sm-12 col-md-4 content">
                <div class="desc">
                    <h1>Meal Planner</h1>
                    <p>blablabal</p>
                </div>

                <h1 class="mt-2">Current Time</h1>
                <time>
                    <div class="clock">
                        <div class="dial-container dial-container--hh js-clock" data-cur="9" data-start="0" data-end="12"
                             data-dur="hh">
                        </div> &nbsp;
                        <div class="dial-container dial-container--mm js-clock" data-cur="2" data-start="0" data-end="5"
                             data-dur="mm">
                        </div>
                        <div class="dial-container dial-container--m js-clock" data-cur="3" data-start="0" data-end="9"
                             data-dur="m">
                        </div>
                        &nbsp;
                        <div class="dial-container dial-container--ss js-clock" data-cur="4" data-start="0" data-end="5"
                             data-dur="ss">
                        </div>
                        <div class="dial-container dial-container--s js-clock" data-cur="8" data-start="0" data-end="9"
                             data-dur="s">
                        </div>
                    </div>
                </time>

                <form>
                    <div class="form-group d-flex flex-column">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <div class="input-group-text"> Schedule a meal time (24HR)</div>
                            </div>
                            <input type="time" class="form-control" id="Time">
                        </div>
                        <div class="input-group mt-2">
                            <div class="input-group-prepend">
                                <div class="input-group-text"> Food item: </div>
                            </div>
                            <input type="text" class="form-control" placeholder="eg. Potato Chips"
                                   id="food">
                        </div>
                        <br>
                        <button type="button" id="myBtn">Schedule</button>
                    </div>
                    <div id="iamUser"></div>
                </form>
                <div id="checkUser"></div>
                <div id='reminder_output'>
                </div>
            </div>

            <!-- The Modal -->
            <div id="myModal" class="modal">

                <!-- Modal content -->
                <div class="modal-content">
                <span class="close">&times;</span>

                <div id="response">
                    <h2>Your total calories for this meal will be:</h2> 
                    <table class="table table-striped" border='1'>
                    <thead>
                        
                        <tr>
                            <th>Food Item</th>
                            <th>Calories</th>
                        </tr>
                    </thead>
                    <tbody id = "results">
                        
                    </tbody>
                    
                </table>

                <div id="calculated"></div>
                </div>
                
                
                <br>
                

                </div>
            
            </div>
  
            

        <script type="text/javascript">

        </script>
        <script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
</body>

<link rel="stylesheet" href="clock.css">
    
    <script src="clock.js"></script>
    <script src="Notification.js"></script>
    <script type="application/javascript">
        document.getElementById("myBtn").addEventListener('click', function(event) {
            event.preventDefault();
            query = document.getElementById("food").value;
            console.log(query);
            console.log(typeof(query));
            data = JSON.stringify({
                'query': query
            })
            console.log(data)

            fetch('http://127.0.0.1:6100/api/calories', {

                method: 'POST',
                headers: {
                    'content-type': 'application/json',

                },
                body: data
            })
            
            .then((response) => response.json())
            .then((data) => {
                
                document.getElementById('results').innerHTML = '';
                console.log(data);
                console.log(typeof(data));
                var items = data.items;
                var calc = 0;
                
                if (items.length) {
                    console.log('yes');
                    var node = ``;
                    // node.innerHTML = ``;
                    
                    for (item of items) {
                        var sugar_g = item.sugar_g;
                        var fiber_g = item.fiber_g;
                        var serving_size_g = item.serving_size_g;
                        var sodium_mg = item.sodium_mg;
                        var name = item.name;
                        var potassium_mg = item.potassium_mg;
                        var fat_saturated_g = item.fat_saturated_g;
                        var fat_total_g = item.fat_total_g;
                        var calories = item.calories;
                        var cholesterol_mg = item.cholesterol_mg;
                        var protein_g = item.protein_g;
                        var carbohydrates_total_g = item.carbohydrates_total_g;
                                
                        calc += parseInt(calories);
                        node += `
                            
                                <tr>
                                    <td>${name}</td>
                                    <td>${calories}</td>
                                </tr>
                        `;
                        
                    }
                    
                    document.getElementById('results').innerHTML += node;
                    document.getElementById('calculated').innerHTML = `<p>Total calories: ` + calc + `</p>`;


                    
                } else {
                    var node = document.createElement('div');
                    
                    document.getElementById('results').innerHTML = node.innerHTML;

                    var node = `<h2 style='color:red'>Error: Item <strong>${query}</strong> not found</h2>`;
                    document.getElementById('response').innerHTML = node;

                }
                
            })
        })


        // <div class="${name}">
        //                     <h1 style='text-transform:capitalize;'><strong>${name}</strong></h1>
        //                     <table id="nutritionTable${name}" class="table table-striped" border='1'>
        //                         <thead class="thead-dark">
        //                             <tr>
        //                                 <th>Serving Size (g)</th>
        //                                 <td>${serving_size_g}</td>
        //                             </tr>
        //                             <tr>
        //                                 <th>Sugar (g)</th>
        //                                 <td>${sugar_g}</td>
        //                             </tr>
        //                             <tr>
        //                                 <th>Fiber (g)</th>
        //                                 <td>${fiber_g}</td>
        //                             </tr>
        //                             <tr>
        //                                 <th>Sodium (mg)</th>
        //                                 <td>${sodium_mg}</td>
        //                             </tr>
        //                             <tr>
        //                                 <th>Potassium (mg)</th>
        //                                 <td>${potassium_mg}</td>
        //                             </tr>
        //                             <tr>
        //                                 <th>Saturated Fats (g)</th>
        //                                 <td>${fat_saturated_g}</td>
        //                             </tr>
        //                             <tr>    
        //                                 <th>Total Fats (g)</th>
        //                                 <td>${fat_total_g}</td>
        //                             </tr>
        //                             <tr>
        //                                 <th>Calories</th>
        //                                 <td>${calories}</td>
        //                             </tr>
        //                             <tr>
        //                                 <th>Cholesterol (mg)</th>
        //                                 <td>${cholesterol_mg}</td>
        //                             </tr>
        //                             <tr>
        //                                 <th>Protein (g)</th>
        //                                 <td>${protein_g}</td>
        //                             </tr>
        //                             <tr>
        //                                 <th>Total Carbohydrates (g)</th>
        //                                 <td>${carbohydrates_total_g}</td>
        //                             </tr>

        //                         </thead>
        //                     </table>
        //                 </div>

    </script>
        <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
</html>