<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">

    <title>Exercise</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  </head>
  <body onload="searchapiall()">

    <div id="nutritioncontainer" class="container">
        <h1 class="display-4">Let us pick an exercise for you!</h1>

        Please enter your weight: <input type="number" id="weight" placeholder="Enter weight in kg"> (todo later)
        <br>
        How long would you like to exercise today? <input type="number" id="time" placeholder="Enter time in minutes">
        <br><br>
        <button type="button" onclick="search()">Search</button>


        <!-- <form id="foodform">
            Search food item: <input type="text" id="food">
            <button type="button" onclick="search()">Submit</button>
        </form> -->
        <br><br>
        <div id="results"></div>

        <br><br><br>
        <h1 class="display-4">Or, browse all exercises here:</h1>
        <div id="all"></div>
    </div>





    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js" integrity="sha384-SR1sx49pcuLnqZUnnPwx6FCym0wLsk5JZuNx2bPPENzswTNFaQU1RDvt3wT4gWFG" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.min.js" integrity="sha384-j0CNLUeiqtyaRmlzUHCPZ+Gy5fQu0dQ6eZ/xAww941Ai1SxSY+0EQqNXNE6DZiVc" crossorigin="anonymous"></script>
    -->

        <script>
            function searchapi(time, weight){
                var url = 'https://esd-healthiswell-69.hasura.app/api/rest/exercise';
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function(){
                    if (this.readyState == 4 && this.status==200){
                        var data = JSON.parse(this.responseText);
                        var exercises = data.ExerciseFatty_Exercises;
                        var html_text = '';

                        if (exercises.length){
                            if (time != "") {
                                document.getElementById('results').innerHTML = '<h2>Here are our recommendations: </h2>';
                            }
                            else {
                                document.getElementById('results').innerHTML = `<h2 style="color:red">Please enter time</h2>`;
                            }
                            
                            for (item of exercises) {

                                var desc = item.Description;
                                var calories_burnt = item.calories_burnt;
                                var ex_id = item.exercise_id;
                                var ex_time = item.exercise_time;
                                var ex_type = item.exercise_type;
                                var type = item.type;

                                if (ex_time <= time) {

                                    var node = document.createElement('div');
                                    node.innerHTML = `
                                    <div class="${ex_id}">
                                        <h2 style='text-align:center'><strong>${ex_type}</strong><h2>
                                        
                                        <h3 style="text-align:center">${desc}</h3>
                                        <table id="${ex_id}" class="table table-striped" border='1'>
                                            <tr>
                                                <th>Difficulty</th>
                                                <td>${type}</td>
                                            </tr>
                                            <tr>
                                                <th>Exercise Time</th>
                                                <td>${ex_time}</td>
                                            </tr>
                                            <tr>
                                                <th>Calories Burnt</th>
                                                <td>${calories_burnt}</td>
                                            </tr>
                                        </table>
                                    </div>
                                    `;
                                    document.getElementById('results').innerHTML += node.innerHTML;

                                }

                                
                                
                            }
                        }
                    }
                };
                xhttp.open('GET', url, true);
                xhttp.setRequestHeader('content-typel', 'application/json');
                xhttp.setRequestHeader('x-hasura-admin-secret', 'Qbbq4TMG6uh8HPqe8pGd1MQZky85mRsw5za5RNNREreufUbTHTSYgaTUquaKtQuk');
                xhttp.send();
            }

            function searchapiall() {
                var url = 'https://esd-healthiswell-69.hasura.app/api/rest/exercise';
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function(){
                    if (this.readyState == 4 && this.status==200){
                        var data = JSON.parse(this.responseText);
                        var exercises = data.ExerciseFatty_Exercises;
                        var html_text = '';

                        if (exercises.length) {
                            for (item of exercises) {

                                var desc = item.Description;
                                var calories_burnt = item.calories_burnt;
                                var ex_id = item.exercise_id;
                                var ex_time = item.exercise_time;
                                var ex_type = item.exercise_type;
                                var type = item.type;

                                var node = document.createElement('div');
                                node.innerHTML = `
                                <div class="${ex_id}">
                                    <h2 style='text-align:center'><strong>${ex_type}</strong><h2>
                                    
                                    <h3 style="text-align:center">${desc}</h3>
                                    <table id="${ex_id}" class="table table-striped" border='1'>
                                        <tr>
                                            <th>Difficulty</th>
                                            <td>${type}</td>
                                        </tr>
                                        <tr>
                                            <th>Exercise Time</th>
                                            <td>${ex_time}</td>
                                        </tr>
                                        <tr>
                                            <th>Calories Burnt</th>
                                            <td>${calories_burnt}</td>
                                        </tr>
                                    </table>
                                </div>
                                `;
                                document.getElementById('all').innerHTML += node.innerHTML;
                            }
                        }
                    }
                };
                xhttp.open('GET', url, true);
                xhttp.setRequestHeader('content-typel', 'application/json');
                xhttp.setRequestHeader('x-hasura-admin-secret', 'Qbbq4TMG6uh8HPqe8pGd1MQZky85mRsw5za5RNNREreufUbTHTSYgaTUquaKtQuk');
                xhttp.send();
            };


            function search() {
                document.getElementById('results').innerHTML = '';
                var time = document.getElementById('time').value;
                var weight = document.getElementById('weight').value;
                var result = searchapi(time, weight);
            }
        </script>
    </body>
</html>